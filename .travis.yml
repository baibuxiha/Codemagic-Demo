os: osx
language: generic
before_script:
- brew update
- brew install --HEAD usbmuxd
- brew unlink usbmuxd
- brew link usbmuxd
- brew install --HEAD libimobiledevice
- brew install ideviceinstaller
- brew install ios-deploy
- git clone https://github.com/flutter/flutter.git -b beta --depth 1
script:
- flutter/bin/flutter build ios --debug --no-codesign
cache:
  directories:
  - "$HOME/.pub-cache"
before_deploy:
- pushd build/ios/iphoneos
- mkdir Payload
- cd Payload
- ln -s ../Runner.app
- cd ..
- zip -r app.ipa Payload
- popd
deploy:
  provider: releases
  api_key:
    secure: wEXTTnyKrIDk4Fz2sliVVca+RVvhGgZnhBK9WbLBMeKo7QIZz0tYnMyYgDG54k6iDnKycT0yXBExScGRTSeG/gPS+Lem2E8RPkM3N/vDyHEBRqYRrpz9pYX6fGp76cO7k+UopR/+abDjWn7RGCjwBoSmyzHriBxxIkJk+OIMscE8BntnzS09fvyTBuFm365QriB2aeySaTaCwYn6YqeKWmWmgMF5qTYodkQaD4+UidMqFarbHW5VTfSJfeAaGFuU4sEMRM15IQSprPzwmsOfGblcW1sDmmG3wLcTZ3LHtUupNNUA0QwHY965mNJP5m39eTONWxdo+UWARfOwVngX2H19gdQX8+CsJO+QybAhwiAK+LjE/NBLcT6R/iZ3f0gXjwzl67SegKR7imvjhXm3lJUcjbszoFuFb3U8rVPbVl9beCShvHnQ0+N2NKbsMDdjfnG3GJKIAo3gueJe78Un2KFUEWZUpc1nCj0vUDrm7XlK75+Ex24hnLPfGsbD+fvb09pgMSCXr7/XCaMBtBRBYKPgscmVKG/8E5BQX2SwObcCNBoNZGSam7+2Qt7LUUv+5Faw9p+RdSrO9zWyxJ2cs6GUkxIzlGVZDmnThcbKGV96v7av2MAZXB+vEgqYHqlnwKWoXcgZTn2ONRDC29ISgiXzm8eH4a4l2n3mhgXyZew=
  file: build/ios/iphoneos/app.ipa
  skip_cleanup: true
  on:
    repo: baibuxiha/Codemagic-Demo
